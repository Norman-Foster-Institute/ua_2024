<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-01-31">

<title>NFI Urban Analytics 2024 - Part 1 - Intro to QGIS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapter_1/qgis_mapping.html" rel="next">
<link href="../chapter_1/gis.html" rel="prev">
<link href=".././assets/nfi_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../custom-style.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">NFI Urban Analytics 2024 - Part 1</span>
    </a>
  </div>
        <div class="quarto-navbar-tools">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapter_1/gis.html">GIS Tools</a></li><li class="breadcrumb-item"><a href="../chapter_1/qgis.html">Intro to QGIS</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src=".././assets/nfi_logo_txt.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/Norman-Foster-Institute/ua_2024" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Setup</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_0/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_0/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Software &amp; Accounts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_0/anaconda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python Notebooks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">GIS Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/gis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to GIS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/qgis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Intro to QGIS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/qgis_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QGIS Mapping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/gis_tips.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/cloud_gis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cloud GIS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/intro_to_tableau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bonus: Tableau</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Basic Coding</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_2/intro_to_python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_2/open_source.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Open Source</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_2/intro_to_geopandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to GeoPandas</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#qgis-ui" id="toc-qgis-ui" class="nav-link active" data-scroll-target="#qgis-ui">QGIS UI</a></li>
  <li><a href="#plugins" id="toc-plugins" class="nav-link" data-scroll-target="#plugins">Plugins</a></li>
  <li><a href="#xyz-tiles" id="toc-xyz-tiles" class="nav-link" data-scroll-target="#xyz-tiles">XYZ Tiles</a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets">Datasets</a></li>
  <li><a href="#coordinate-reference-systems" id="toc-coordinate-reference-systems" class="nav-link" data-scroll-target="#coordinate-reference-systems">Coordinate Reference Systems</a></li>
  <li><a href="#loading-data" id="toc-loading-data" class="nav-link" data-scroll-target="#loading-data">Loading Data</a></li>
  <li><a href="#saving-and-exporting-data" id="toc-saving-and-exporting-data" class="nav-link" data-scroll-target="#saving-and-exporting-data">Saving and exporting data</a></li>
  <li><a href="#attributes" id="toc-attributes" class="nav-link" data-scroll-target="#attributes">Attributes</a></li>
  <li><a href="#loading-csv-files" id="toc-loading-csv-files" class="nav-link" data-scroll-target="#loading-csv-files">Loading CSV files</a></li>
  <li><a href="#selecting-and-deleting-features" id="toc-selecting-and-deleting-features" class="nav-link" data-scroll-target="#selecting-and-deleting-features">Selecting and deleting features</a></li>
  <li><a href="#joins" id="toc-joins" class="nav-link" data-scroll-target="#joins">Joins</a></li>
  <li><a href="#visualisation" id="toc-visualisation" class="nav-link" data-scroll-target="#visualisation">Visualisation</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapter_1/gis.html">GIS Tools</a></li><li class="breadcrumb-item"><a href="../chapter_1/qgis.html">Intro to QGIS</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Intro to QGIS</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Lecture date</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 31, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Last update</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">February 19, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="qgis-ui" class="level2">
<h2 class="anchored" data-anchor-id="qgis-ui">QGIS UI</h2>
<p>We’ll first explore the QGIS user interface, taking some time to explore:</p>
<ul>
<li><strong>Main Interface</strong>: The map area, toolbars, layers panel, status bar, dock panels.</li>
<li><strong>Toolbars</strong>: These are collections of icons and tools that provide quick access to commonly used features and functions in QGIS. These can be customised based on your preferences. Some of the common toolbars provide functionality such as zooming, panning, selecting features, and editing features.</li>
<li><strong>Map View</strong>: This is the central area where your maps and layers are displayed. We’ll explore how to navigate the map view, including zooming, panning, and identifying features.</li>
<li><strong>Browser Panel</strong>: For browsing and loading data from your file system, databases, and web services.</li>
<li><strong>Layers Panel</strong>: Here, you can see a list of all the layers loaded in your project. Layers can be organised, styled, and otherwise configured.</li>
<li><strong>Attribute Table</strong>: This panel lets you view and edit the attribute data associated with your vector layers.</li>
<li><strong>Status Bar</strong>: Located at the bottom, the status bar shows information about the map and your project, such as the current map scale, the coordinate reference system, and messaging about ongoing processes.</li>
<li><strong>Plugins</strong>: QGIS can be extended with plugins. We’ll briefly touch on how to find, install, and use plugins to enhance the functionality of QGIS.</li>
</ul>
</section>
<section id="plugins" class="level2">
<h2 class="anchored" data-anchor-id="plugins">Plugins</h2>
<p>Install the Quick Map Services (QMS) Plugin:</p>
<ul>
<li>From the <code>Plugins</code> menu, select <code>Manage and Install Plugins</code></li>
<li>Search for <code>QMS</code></li>
<li>Install <code>QuickMapServices</code></li>
<li><code>Install</code> and <code>Close</code> the window.</li>
</ul>
<p>This plugin will add a new menu entry under the <code>Web</code> menu.</p>
<ul>
<li>From the <code>Web</code> menu, select <code>QuickMapServices</code>, then <code>OSM</code> and <code>OSM Standard</code>.</li>
<li>This will add a map to your map view.</li>
</ul>
</section>
<section id="xyz-tiles" class="level2">
<h2 class="anchored" data-anchor-id="xyz-tiles">XYZ Tiles</h2>
<p>XYZ tiles are a popular way to represent map tile data in a simple and standardized format, allowing for efficient storage, retrieval, and display of map imagery at various scales. The “XYZ” refers to the coordinate system used to locate the tiles. “X” and “Y” represent the tile’s column and row, respectively, in a grid layout, with the origin typically at the top-left corner of the map. The “Z” parameter stands for zoom level, where higher zoom levels correspond to more detailed views (i.e., a higher resolution). This system enables GIS applications to quickly load the appropriate level of detail for a given view, making it a cornerstone of web mapping services like Google Maps and OpenStreetMap. It allows for seamless and efficient navigation across various scales and locations on a digital map.</p>
<p>To establish a new connection:</p>
<ul>
<li>On the Browser panel, right-click on <code>XYZ Tiles</code> -&gt; <code>New Connection...</code></li>
<li>Asign a name to the connection (eg. <em>OpenStreetMap</em>)</li>
<li>Paste the respective <code>URL</code></li>
</ul>
<p>Depending on the connection, some of other connection attributes might be required (eg. Authentication details)</p>
<blockquote class="blockquote">
<p>We reccomend you establish at least the following connections: - <strong>OpenStreetMap</strong> : https://tile.openstreetmap.org/{z}/{x}/{y}.png - <strong>Google Imagery Hybrid</strong> : http://mt0.google.com/vt/lyrs=y&amp;hl=en&amp;x={x}&amp;y={y}&amp;z={z}&amp;s=Ga</p>
</blockquote>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Useful list of many others Tiles. <a href="https://tile.openstreetmap.org/%7Bz%7D/%7Bx%7D/%7By%7D.png">https://qms.nextgis.com</a> Note, make sure you navigate to the TMS section and the reported status = <code>works</code> (symbolised with the green dot).</p>
</div>
</div>
</section>
<section id="datasets" class="level2">
<h2 class="anchored" data-anchor-id="datasets">Datasets</h2>
<ul>
<li><p>Download the municipal neighbourhoods as a SHP file: <a href="https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=760e5eb0d73a7710VgnVCM2000001f4a900aRCRD&amp;vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&amp;vgnextfmt=default">Barrios municipales de Madrid</a></p></li>
<li><p>Download the population by district and neighbourhood dataset as a CSV file: <a href="https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=0cccaebc07c1f710VgnVCM2000001f4a900aRCRD&amp;vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&amp;vgnextfmt=default">Población por distrito y barrio a 1 de enero</a></p></li>
</ul>
</section>
<section id="coordinate-reference-systems" class="level2">
<h2 class="anchored" data-anchor-id="coordinate-reference-systems">Coordinate Reference Systems</h2>
<p>Geospatial data is represented using a coordinate reference system (CRS). QGIS will ordinarily detect this information automatically. However, it can display information in any selected CRS, so you can open multiple files in different CRSs and these will display correctly. This is because QGIS will reproject each respective file into the map’s currently selected CRS system.</p>
<p>In the lower right corner of the status bar at the bottom of the screen:</p>
<ul>
<li>Select the CRS button to open the project’s CRS configuration.</li>
<li>Search for CRS code <code>3857</code>, then select it, <code>Apply</code>, and <code>OK</code>.</li>
</ul>
<blockquote class="blockquote">
<p>Hint: When using OSM base maps, the base maps will render more performantly in the Web Mercator projection (<code>3857</code>). This is because QGIS then doesn’t need to dynamically reproject the map tiles out of their native <code>3857</code> projection.</p>
</blockquote>
</section>
<section id="loading-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-data">Loading Data</h2>
<p>Load your first dataset by dragging and dropping the shapefile (the downloaded file ending with <code>.shp</code>) into your map view.</p>
<ul>
<li>You can toggle layer visibility and order using the Layers Panel.</li>
<li>Use the <code>Select Features</code> button to select a feature and see it highlighted.</li>
<li>Click the <code>Pan Map to Selection</code> button to see the map zoom to the currently selected feature</li>
<li>Click the <code>Zoom Full</code> button to return to a view of the full dataset.</li>
<li>Use the <code>Identify Features</code> button to see attribute information for a particular feature.</li>
<li>Click the <code>Toggle Editing</code> button -&gt; this will let you delete existing features or add new features - use with caution! Don’t make any changes for now, just click the <code>Toggle Editing</code> button again to exit edit mode.</li>
</ul>
</section>
<section id="saving-and-exporting-data" class="level2">
<h2 class="anchored" data-anchor-id="saving-and-exporting-data">Saving and exporting data</h2>
<p>We don’t want to edit the original dataset, so let’s make a copy and work with that instead:</p>
<ul>
<li>Right click the layer in the Layer Panel and select <code>export</code> -&gt; <code>Save Features as</code></li>
<li>Select the <code>GeoPackage</code> format.</li>
<li>Select a file location on disk and give it a distinctive name such as <code>my_gpkg</code>.</li>
<li>Select <code>3035</code> for the CRS projection</li>
<li>Check that <code>Add saved file to map</code> at the bottom of the window is selected</li>
<li>Select <code>OK</code></li>
<li>The file will be saved and will automatically load into your map.</li>
<li>Remove the original <code>SHP</code> file from your Layers Panel since it is no longer needed. This can be done with the <code>Remove Layer</code> button.</li>
</ul>
</section>
<section id="attributes" class="level2">
<h2 class="anchored" data-anchor-id="attributes">Attributes</h2>
<p>Attributes in GIS layers provide additional information about the spatial features in the data. They include text, numbers, dates, or images. Attributes help add context to the geographic elements, enabling better analysis and visualization. They can be used to filter, classify, and symbolize features based on their characteristics. Attributes play a crucial role in data analysis, allowing us to gain insights, make comparisons, and create meaningful visual representations.</p>
<p>Using the Municipal Boundaries <code>my_gpkg</code> dataset:</p>
<ul>
<li>Open the attribute table for the neighbourhood boundaries by right clicking on the layer in the Layers Panel and selecting <code>Attribute Table</code>. From the Attribute table you can try the same steps you tried for the map view (selecting, zooming to, editing).</li>
<li>Toggle Editing Mode by pressing the <code>Toggle Editing Mode</code> button.</li>
<li>Click on the <code>New Field</code> button in the toolbar</li>
<li>Set the Name as <code>area</code> and the type as <code>Decimal number</code>, then <code>OK</code>.</li>
<li>Check that no rows are selected (otherwise the calculation only applies to the selected rows).</li>
<li>Open the Field Calculator by clicking its icon (abacus symbol) in the toolbar.</li>
<li>Select <code>Update existing field</code> and select the <code>area</code> column.</li>
<li>In the <code>Expression</code> pane, enter <code>$area</code>, then press the blue forward button below to preview the results of the calculation.</li>
<li>Press <code>OK</code> and check that your area column has been updated.</li>
<li>Press the <code>Save edits</code> button to save your calculation.</li>
<li>Turn off editing mode.</li>
</ul>
<p>We’ll now add another column, this time we’ll use another column as input and we will transform the data from a text to an integer.</p>
<ul>
<li>Turn editing mode on</li>
<li>Open the Field Calculator</li>
<li>This time select <code>Create a new field</code> and call it <code>cod_barrio</code></li>
<li>Check that it is an <code>Integer</code> type</li>
<li>In the expression, enter <code>to_int(COD_BAR)</code> -&gt; this will take the text from the <code>COD_BAR</code> column and will cast this to an integer. In the process, the data will drop the leading zero.</li>
<li>Apply the change, save to disk, and toggle editing to off.</li>
</ul>
</section>
<section id="loading-csv-files" class="level2">
<h2 class="anchored" data-anchor-id="loading-csv-files">Loading CSV files</h2>
<ul>
<li>To load the CSV file we’ll go to the <code>Layer</code> menu bar, <code>Add Layer</code>, then <code>Add Delimited Text Layer</code>.</li>
<li>For <code>File name</code>, navigate to your CSV file and open it. If the load window dissapears (on a Mac), it might be hiding behind the main application window.</li>
<li>This file uses semi-colon delimeters, so select <code>Custom delimiters</code> and check that <code>Semicolon</code> is selected</li>
<li>Check that the option for <code>First record has field names</code> is selected. This will automatically use the first line of the CSV to set the attribute names.</li>
<li>Select <code>No geometry</code>. This will load the dataset without visual geometric information. Note that if you have longitude and latitude information in CSV columns (or Eastings and Northings for projected CRS), then you can specify these columns and QGIS will generate the point geometries accordingly.</li>
<li>Select <code>Add</code> then <code>Close</code>.</li>
<li>Note that this layer looks different in the Layers Panel because it doesn’t have associated geometry. However, you can still view the Attribute Table.</li>
<li>Right click on the layer and select <code>export</code> -&gt; <code>Save Features as</code>. Then save the layer as a new CSV file called <code>my_csv</code>. As before, select the option to add the layer to the map, save, then remove the original input CSV from the Layers Panel.</li>
</ul>
</section>
<section id="selecting-and-deleting-features" class="level2">
<h2 class="anchored" data-anchor-id="selecting-and-deleting-features">Selecting and deleting features</h2>
<ul>
<li>Open the attribute table for the <code>my_csv</code> layer by right clicking on the data table in the Layers Panel and selecting <code>Attribute Table</code>.</li>
<li>Order the data by clicking the <code>fecha</code> column header, order in descending order by clicking again.</li>
<li>Click on the first entry (which should be <code>1 de enero de 2023</code>) then hold down shift and click on the last entry with a <code>fecha</code> value of <code>1 de enero de 2023</code>.</li>
<li>Click the <code>Invert selection</code> button, this will invert the selection so you only have entries selected that are not <code>1 de enero de 2023</code>.</li>
<li>Click the <code>Delete selected features</code> button.</li>
<li>Manually select the row with a <code>cod_distrito</code> value of <code>Todos</code>, and delete it, since this is an aggregated row containing aggregated information for all districts.</li>
<li>Open the Field Calculator, and this time select to create a new field called <code>num_people</code> as a <code>Decimal</code> type.</li>
<li>Use the following expression to populate the field: <code>to_real("num_personas")</code> - this will take the original <code>num_personas</code> column and will convert it from text format to numeric format, and writes it to a new column called <code>num_people</code>. We can then use this numeric column for map styling.</li>
<li>Save and turn off editing.</li>
</ul>
</section>
<section id="joins" class="level2">
<h2 class="anchored" data-anchor-id="joins">Joins</h2>
<ul>
<li>Open the Attribute Panels for both the <code>my_gpkg</code> and the <code>my_csv</code> layers.</li>
<li>We want to “Join” information from the CSV dataset to the neighbourhood boundaries using the matching identifiers in the respective <code>cod_barrio</code> / <code>cod_barrio</code> columns. We are now just visually inspecting the data, so you can go ahead and close the Attribute Panels when done.</li>
<li>Double click on the <code>my_gpkg</code> layer to open the properties panel.</li>
<li>Click <code>Joins</code> in the left sidebar.</li>
<li>Click the plus button to create a new join.</li>
<li>Select the <code>my_csv</code> table for the <code>Join layer</code> -&gt; the layer from which attributes will be joined to <code>my_gpkg</code>.</li>
<li>Select the <code>cod_barrio</code> column for the <code>Join field</code> - this refers to the <code>cod_barrio</code> column in the <code>my_csv</code> file.</li>
<li>Select the <code>cod_barrio</code> column for the <code>Target field</code> – this refers to the <code>cod_barrio</code> column in the <code>my_gpkg</code> file.</li>
<li>Click <code>OK</code> and close the layer properties. This will “weld” the <code>my_csv</code> columns onto the matching <code>my_gpkg</code> geometries so that we can view the census information using their geographic boundaries.</li>
<li>Reopen the Attribute Panel for the <code>my_gpkg</code> dataset, you’ll see extra columns which have now joined the data from the <code>my_csv</code> table into their corresponding boundaries based on the matching identifiers.</li>
<li>Let’s export this to a new file to <code>my_joined_gpkg</code>, which will now include the joined data.</li>
<li>Remove <code>my_csv</code> and <code>my_gpkg</code> from the Layers Panel.</li>
</ul>
</section>
<section id="visualisation" class="level2">
<h2 class="anchored" data-anchor-id="visualisation">Visualisation</h2>
<ul>
<li>Open the <code>my_joined_gpkg</code> layer properties by double clicking on the layer name in the Layers Panel.</li>
<li>Select <code>Labels</code> in the left pane, select <code>Single Labels</code>, then select the <code>NOMBRE</code> column, then apply. This will add the Barrio names to the map. You can format labels to your heart’s content.</li>
<li>Select <code>Symbology</code> in the left pane. You can try use the “graduated” view option (select from the top drop-down) to view the <code>area</code> column information (select from the “Value” drop-down) or the <code>csv_num_people</code> column information on your map.</li>
<li>You can use different “Mode” options - press the <code>Classify</code> button to see how they detect different thresholds for the colour bands.</li>
<li>Press <code>Apply</code> to see the changes on the map.</li>
<li>There are almost limitless options so feel free to be creative.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/madrid_pop_labels.png" class="img-fluid figure-img"></p>
<figcaption>Madrid’s 2023 population distribution - Greg Maya</figcaption>
</figure>
</div>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p>If you are feeling like doing a little more you can look at the <a href="../chapter_1/qgis_mapping.html">QGIS mapping section</a> and/or any of the following online materials. There is a lot that can be done with QGIS and we have just skimmed the surface!</p>
<p>The <a href="https://www.qgistutorials.com/en/index.html">QGIS Tutorials and Tips</a> is a great resource for QGIS.</p>
<p>For lab-work, please do the following tutorials from <a href="https://www.qgistutorials.com/en/docs/introduction.html">QGIS Tutorials and Tips</a> in your own time to build some general familiarity with QGIS:</p>
<ul>
<li><a href="https://www.qgistutorials.com/en/docs/3/making_a_map.html">Making a Map</a></li>
<li><a href="https://www.qgistutorials.com/en/docs/3/basic_vector_styling.html">Basic Vector Styling</a></li>
<li><a href="https://www.qgistutorials.com/en/docs/3/digitizing_basics.html">Digitizing Map Data</a></li>
<li><a href="https://www.qgistutorials.com/en/docs/3/working_with_projections.html">Working with Projections</a></li>
<li><a href="https://www.qgistutorials.com/en/docs/3/creating_heatmaps.html">Creating Heatmaps</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapter_1/gis.html" class="pagination-link" aria-label="Intro to GIS">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Intro to GIS</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapter_1/qgis_mapping.html" class="pagination-link" aria-label="QGIS Mapping">
        <span class="nav-page-text">QGIS Mapping</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/Norman-Foster-Institute/ua_2024/blob/main/LICENSE">
<p>License</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>