<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>NFI Urban Analytics 2024 - Part 1 - Pandas &amp; Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href=".././assets/nfi_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../custom-style.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">NFI Urban Analytics 2024 - Part 1</span>
    </a>
  </div>
        <div class="quarto-navbar-tools">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Pandas &amp; Data</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src=".././assets/nfi_logo_txt.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/Norman-Foster-Institute/ua_2024" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Setup</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_0/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_0/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Software &amp; Accounts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_0/anaconda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python Notebooks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">GIS Tools</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/gis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to GIS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/qgis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to QGIS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/qgis_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QGIS Mapping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/gis_tips.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/cloud_gis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cloud GIS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/intro_to_tableau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bonus: Tableau</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Basic Coding</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_2/intro_to_python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_2/open_source.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Open Source</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#pandas-data" id="toc-pandas-data" class="nav-link active" data-scroll-target="#pandas-data">Pandas &amp; Data</a>
  <ul class="collapse">
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#munging-and-wrangling" id="toc-munging-and-wrangling" class="nav-link" data-scroll-target="#munging-and-wrangling">Munging and wrangling</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#pandas-101" id="toc-pandas-101" class="nav-link" data-scroll-target="#pandas-101">Pandas 101</a>
  <ul class="collapse">
  <li><a href="#data-structures" id="toc-data-structures" class="nav-link" data-scroll-target="#data-structures">Data Structures</a></li>
  <li><a href="#inspect" id="toc-inspect" class="nav-link" data-scroll-target="#inspect">Inspect</a></li>
  <li><a href="#summary-statistics" id="toc-summary-statistics" class="nav-link" data-scroll-target="#summary-statistics">Summary Statistics</a></li>
  <li><a href="#create-new-columns" id="toc-create-new-columns" class="nav-link" data-scroll-target="#create-new-columns">Create new columns</a></li>
  <li><a href="#index-based-queries" id="toc-index-based-queries" class="nav-link" data-scroll-target="#index-based-queries">Index-based queries</a></li>
  <li><a href="#condition-based-queries" id="toc-condition-based-queries" class="nav-link" data-scroll-target="#condition-based-queries">Condition-based queries</a></li>
  <li><a href="#combining-queries" id="toc-combining-queries" class="nav-link" data-scroll-target="#combining-queries">Combining queries</a></li>
  <li><a href="#sorting" id="toc-sorting" class="nav-link" data-scroll-target="#sorting">Sorting</a></li>
  </ul></li>
  <li><a href="#visual-exploration" id="toc-visual-exploration" class="nav-link" data-scroll-target="#visual-exploration">Visual Exploration</a>
  <ul class="collapse">
  <li><a href="#histograms" id="toc-histograms" class="nav-link" data-scroll-target="#histograms">Histograms</a></li>
  <li><a href="#line-and-bar-plots" id="toc-line-and-bar-plots" class="nav-link" data-scroll-target="#line-and-bar-plots">Line and bar plots</a></li>
  </ul></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data">Tidy data</a></li>
  <li><a href="#grouping-transforming-aggregating" id="toc-grouping-transforming-aggregating" class="nav-link" data-scroll-target="#grouping-transforming-aggregating">Grouping, transforming, aggregating</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Pandas &amp; Data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="pandas-data" class="level1">
<h1>Pandas &amp; Data</h1>
<p>Now that you know some of the basics of Python Notebooks, it’s time to start using them for data science (no, that simple math you did the last time doesn’t count as data science!).</p>
<p>You are about to enter the Python data ecosystem. This course does not explicitly cover the fundamentals of programming; if you’re stuck, confused, or need further explanation, the answers are more often than not easily accessible through online resources such as your favourite search engine, <a href="https://stackoverflow.com">Stack Overflow</a>, and the amazingly capable explanatory power of emerging AI tools such as <a href="https://chat.openai.com">ChatGPT</a>. The internet is a friend of every programmer and you’re encouraged to use it effectively from the get-go. There has never been an easier time to learn how to code!</p>
<p>Let’s dig in!</p>
<blockquote class="blockquote">
<p>This notebook can be <a href="https://github.com/Norman-Foster-Institute/ua_2024/tree/main/chapter_1">downloaded from here</a>.</p>
</blockquote>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>This section is adapted from the <a href="https://github.com/martinfleis/sds">Spatial Data Science for Social Geography</a> by Martin Fleischman, which in turn is based on <a href="https://darribas.org/gds_course/content/home.html">A Course on Geographic Data Science</a> by Dani Arribas-Bel, both licensed under CC-BY-SA 4.0. The content and datasets were reworked to accommodate the Madrid neighbourhood population statistics dataset.</p>
</section>
<section id="munging-and-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="munging-and-wrangling">Munging and wrangling</h2>
<p>Real-world datasets are messy. There is no way around it: datasets have “holes” (missing data), the number of formats in which data can be stored can be endless, and the best structure to share data is not always the optimal for analysis. Hence the need to “munge” or “wrangle” data. Much of the time spent in what is called Data Science is related not only to modelling and insight but more often than not has to do with much more basic and less exotic tasks such as obtaining the data, data cleaning, and other preparation which makes analysis possible.</p>
<p>Surprisingly, very little has been published on patterns, techniques, and best practices for quick and efficient data cleaning, manipulation, and transformation because of how labour-intensive this aspect is. In this session, we will use real-world datasets and learn how to transform and manipulate these, if necessary, prior to analysis. For this, we will introduce some of the bread-and-butter of data analysis and scientific computing in Python. These are fundamental tools that are widely and consistently used on almost any tasks relating to data analysis.</p>
<p>This notebook covers the basics and the content that needs to be grasped, and discusses several patterns to clean and structure data properly, including tidying, subsetting, and aggregating. We will conclude with some basic visualisation. An additional extension presents more advanced tricks to manipulate tabular data.</p>
</section>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<p>We will be exploring demographic characteristics of Madrid. The data has been aggregated to a neighbourhood level by the statistic’s office of Madrid’s City Hall. It contains information per year (from 2018 to 2023) and theme.</p>
<p>As with many datasets that will be used during this course, the data was originally found in an online data portal at the <a href="https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=0cccaebc07c1f710VgnVCM2000001f4a900aRCRD&amp;vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&amp;vgnextfmt=default">following link</a></p>
<p>The main tool we will use for this task is the <code>pandas</code> package. As with any Python module or package, the Pandas package has to be imported into the Notebook prior to usage.</p>
<div id="ae259309" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pandas let’s us work with datasets, and stores the information in a <code>DataFrame</code> consisting of rows and columns. Here, we will read an online <code>csv</code> dataset into a Pandas <code>DataFrame</code>. Pandas can open local files directly, but also has the nifty ability to download files directly from the web:</p>
<div id="32a8c692" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here we will directly fetch the CSV dataset and save it as a Pandas DataFrame</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>madrid_pop <span class="op">=</span> pd.read_csv(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://datos.madrid.es/egob/catalogo/300557-0-poblacion-distrito-barrio.csv"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    sep<span class="op">=</span><span class="st">";"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p><strong>Delimiters</strong></p>
<p>In this case we are using the Pandas <code>read_csv</code> method because the source file is a <code>csv</code>. By default, <code>csv</code> files are assumed to use commas for data delimitation, but this file uses semi-colons instead. This is why we are passing the optional <code>sep</code> parameter to specify a <code>;</code> delimeter.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Formats</strong></p>
<p>Note that <code>pandas</code> allows for many more formats to be read and written. A full list of formats supported may be found in <a href="https://pandas.pydata.org/docs/user_guide/io.html">the documentation</a>.</p>
</blockquote>
<p>It is also possible to download the file and read it locally. In this case, you would download the file by clicking on <a href="https://datos.madrid.es/egob/catalogo/300557-0-poblacion-distrito-barrio.csv">this link</a>. Then place it in the same folder as the notebook where you intend to read it from, and run the below cell.</p>
<div id="6f3a123e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remember, this cell will only work if you have downloaded the file</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and, if the filepath is correct!</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># uncomment the below lines to run!</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># madrid_pop = pd.read_csv(</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     "poblacion_1_enero.csv",</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     sep=";",</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pandas-101" class="level2">
<h2 class="anchored" data-anchor-id="pandas-101">Pandas 101</h2>
<p>Now, we are ready to start playing and interrogating the dataset! What you have at your fingertips is a table summarising, for each of the districts in Madrid, how many people lived there by gender. These tables are called <code>DataFrame</code> objects, and they have a lot of functionality built-in to explore and manipulate the data they contain. Let’s explore a few of those cool tricks!</p>
<section id="data-structures" class="level3">
<h3 class="anchored" data-anchor-id="data-structures">Data Structures</h3>
<p>The first aspect worth spending a bit of time on is the structure of a <code>DataFrame</code>. You can print it by simply typing its name:</p>
<div id="870dd8a8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>madrid_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fecha</th>
<th data-quarto-table-cell-role="th">cod_municipio</th>
<th data-quarto-table-cell-role="th">municipio</th>
<th data-quarto-table-cell-role="th">cod_distrito</th>
<th data-quarto-table-cell-role="th">distrito</th>
<th data-quarto-table-cell-role="th">cod_barrio</th>
<th data-quarto-table-cell-role="th">barrio</th>
<th data-quarto-table-cell-role="th">num_personas</th>
<th data-quarto-table-cell-role="th">num_personas_hombres</th>
<th data-quarto-table-cell-role="th">num_personas_mujeres</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>Centro</td>
<td>1</td>
<td>Centro</td>
<td>139.687</td>
<td>70.770</td>
<td>68.917</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>2</td>
<td>Arganzuela</td>
<td>2</td>
<td>Arganzuela</td>
<td>153.304</td>
<td>71.754</td>
<td>81.550</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>3</td>
<td>Retiro</td>
<td>3</td>
<td>Retiro</td>
<td>117.918</td>
<td>53.458</td>
<td>64.460</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>4</td>
<td>Salamanca</td>
<td>4</td>
<td>Salamanca</td>
<td>145.702</td>
<td>64.452</td>
<td>81.250</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>5</td>
<td>Chamartín</td>
<td>5</td>
<td>Chamartín</td>
<td>144.796</td>
<td>65.245</td>
<td>79.551</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">913</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>Barajas</td>
<td>212</td>
<td>Aeropuerto</td>
<td>1.794</td>
<td>922</td>
<td>872</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">914</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>Barajas</td>
<td>213</td>
<td>CascoHistóricodeBarajas</td>
<td>7.336</td>
<td>3.550</td>
<td>3.786</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">915</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>Barajas</td>
<td>214</td>
<td>Timón</td>
<td>11.750</td>
<td>5.651</td>
<td>6.099</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">916</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>Barajas</td>
<td>215</td>
<td>Corralejos</td>
<td>7.510</td>
<td>3.657</td>
<td>3.853</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">917</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>3.221.824</td>
<td>1.500.340</td>
<td>1.721.484</td>
</tr>
</tbody>
</table>

<p>918 rows × 10 columns</p>
</div>
</div>
</div>
</div>
<p>As you can expect, the dataset was provided in the original local language, so to make things a little easier, we are going to translate the column names using one list of texts. for this we will reassign the column names corresponding to their English equivalents.</p>
<blockquote class="blockquote">
<p><em>Note that there are multiple ways of arriving at the same output, the below is just one of them</em></p>
</blockquote>
<div id="cell-13" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>en_cols <span class="op">=</span> [</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"date"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"code_municipality"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"municipality"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"code_district"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"district"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"code_neighbourhood"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"neighbourhood"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"num_people"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"num_people_men"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"num_people_women"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>madrid_pop.columns <span class="op">=</span> en_cols</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>madrid_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>Centro</td>
<td>1</td>
<td>Centro</td>
<td>139.687</td>
<td>70.770</td>
<td>68.917</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>2</td>
<td>Arganzuela</td>
<td>2</td>
<td>Arganzuela</td>
<td>153.304</td>
<td>71.754</td>
<td>81.550</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>3</td>
<td>Retiro</td>
<td>3</td>
<td>Retiro</td>
<td>117.918</td>
<td>53.458</td>
<td>64.460</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>4</td>
<td>Salamanca</td>
<td>4</td>
<td>Salamanca</td>
<td>145.702</td>
<td>64.452</td>
<td>81.250</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>5</td>
<td>Chamartín</td>
<td>5</td>
<td>Chamartín</td>
<td>144.796</td>
<td>65.245</td>
<td>79.551</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">913</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>Barajas</td>
<td>212</td>
<td>Aeropuerto</td>
<td>1.794</td>
<td>922</td>
<td>872</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">914</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>Barajas</td>
<td>213</td>
<td>CascoHistóricodeBarajas</td>
<td>7.336</td>
<td>3.550</td>
<td>3.786</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">915</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>Barajas</td>
<td>214</td>
<td>Timón</td>
<td>11.750</td>
<td>5.651</td>
<td>6.099</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">916</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>Barajas</td>
<td>215</td>
<td>Corralejos</td>
<td>7.510</td>
<td>3.657</td>
<td>3.853</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">917</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>3.221.824</td>
<td>1.500.340</td>
<td>1.721.484</td>
</tr>
</tbody>
</table>

<p>918 rows × 10 columns</p>
</div>
</div>
</div>
</div>
<p>The default printing is truncated to keep a compact view, but is enough to convey its structure. <code>DataFrame</code> objects have two dimensions: rows and columns. Rows are typically identified with an index column and columns are typically identified with names describing their content. The above example shows how the column names were automatically lifted from the <code>csv</code> file’s column headers.</p>
<p>We can set the row index using the <code>set_index()</code> method. Let’s set the index to use the <code>district</code> column.</p>
<div id="1e296855" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove leading and trailing spaces from 'distrito'</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>madrid_pop[<span class="st">"district"</span>] <span class="op">=</span> madrid_pop[<span class="st">"district"</span>].<span class="bu">str</span>.strip()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set the index based on the district column</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>madrid_pop.set_index(<span class="st">"district"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Columns can be assigned as one of various forms of data such as integers as <code>int</code>, decimals as <code>float</code>, text as <code>str</code>, or if pandas is unable to use a standard type, it might use the <code>object</code> type as a catch-all type.</p>
<p>To extract a single column from this <code>DataFrame</code>, specify its name in square brackets (<code>[]</code>). Note that the name is a <code>string</code> - a piece of text - which needs to be denoted with single (<code>'</code>) or double quotes (<code>"</code>). Without the quotes, Python will think you are referring to a variable, and will then complain that the variable can’t be found!</p>
<p>A single column is not a <code>DataFrame</code> but a <code>Series</code>, which also means that a <code>DataFrame</code> is a collection of <code>Series</code>!</p>
<div id="b7a3fd02" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this will fetch and return the num_people_women column as a Series</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>madrid_pop[<span class="st">"num_people_women"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>district
Centro           68.917
Arganzuela       81.550
Retiro           64.460
Salamanca        81.250
Chamartín        79.551
                ...    
Barajas             872
Barajas           3.786
Barajas           6.099
Barajas           3.853
Todos         1.721.484
Name: num_people_women, Length: 918, dtype: object</code></pre>
</div>
</div>
</section>
<section id="inspect" class="level3">
<h3 class="anchored" data-anchor-id="inspect">Inspect</h3>
<p>You can specifically print the <code>DataFrames</code> top (or bottom) lines by passing a number to the method <code>head</code> or <code>tail</code>. For example, for the top or bottom three lines:</p>
<div id="1c13eeff" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>madrid_pop.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>139.687</td>
<td>70.770</td>
<td>68.917</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Arganzuela</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>2</td>
<td>2</td>
<td>Arganzuela</td>
<td>153.304</td>
<td>71.754</td>
<td>81.550</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Retiro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>3</td>
<td>3</td>
<td>Retiro</td>
<td>117.918</td>
<td>53.458</td>
<td>64.460</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="a00b0027" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>madrid_pop.tail(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Barajas</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>214</td>
<td>Timón</td>
<td>11.750</td>
<td>5.651</td>
<td>6.099</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Barajas</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>215</td>
<td>Corralejos</td>
<td>7.510</td>
<td>3.657</td>
<td>3.853</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Todos</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>3.221.824</td>
<td>1.500.340</td>
<td>1.721.484</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Inspecting datasets is vital to find errors that might skew your analysis. The last row of the dataset contains the sums of other column values ( Spanish: <em><code>Todos</code></em> -&gt; English: <em><code>All</code></em> ).</p>
<p>Before continuing, let’s fix this by removing these columns from the dataset. First, let’s check if we have any more occurrences of <em><code>Todos</code></em>. We can use Pandas’ <code>loc</code> indexer to fetch rows where the index column contains the text string <code>Todos</code>.</p>
<div id="cell-22" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>madrid_pop.loc[<span class="st">"Todos"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Todos</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>3.339.931</td>
<td>1.559.866</td>
<td>1.780.065</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Todos</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>3.286.662</td>
<td>1.534.824</td>
<td>1.751.838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Todos</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>3.312.310</td>
<td>1.545.157</td>
<td>1.767.153</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Todos</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>3.334.730</td>
<td>1.554.732</td>
<td>1.779.998</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Todos</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>3.266.126</td>
<td>1.521.178</td>
<td>1.744.948</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Todos</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>Todos</td>
<td>Todos</td>
<td>Todos</td>
<td>3.221.824</td>
<td>1.500.340</td>
<td>1.721.484</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Now that we know that for every year the data has been aggregated and added back as a new row, we know that removing the last row would not be enough to correct our DataFrame.</p>
<p>We will make use of the <code>drop</code> function in combination with the native <code>loc</code> function of DataFrames.</p>
<div id="cell-24" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rows before droping values: "</span>, <span class="bu">len</span>(madrid_pop))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>madrid_pop.drop(index<span class="op">=</span><span class="st">"Todos"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rows after droping values: "</span>, <span class="bu">len</span>(madrid_pop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows before droping values:  918
Rows after droping values:  912</code></pre>
</div>
</div>
<p>Now, let’s get an overview of the table:</p>
<div id="d80a3eba" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>madrid_pop.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 912 entries, Centro to Barajas
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype 
---  ------              --------------  ----- 
 0   date                912 non-null    object
 1   code_municipality   912 non-null    int64 
 2   municipality        912 non-null    object
 3   code_district       912 non-null    object
 4   code_neighbourhood  912 non-null    object
 5   neighbourhood       912 non-null    object
 6   num_people          912 non-null    object
 7   num_people_men      912 non-null    object
 8   num_people_women    912 non-null    object
dtypes: int64(1), object(8)
memory usage: 71.2+ KB</code></pre>
</div>
</div>
<p><strong>Can you spot something wrong?</strong></p>
<p>Integer numbers are sometimes stored as text values, especially if the input dataset contained commas, periods, or null data values. The actual values of population counts would be better stored as full integers so that we can more effectively work with this data as a numeric data type. Let’s take the following steps:</p>
<ol type="1">
<li>Create a list containg the column names that have people counts</li>
<li>Loop through the list, removing periods from the numbers, then casting the values to integer types while allowing for <code>null</code> data values</li>
</ol>
<div id="cell-28" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of columns to process</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>columns_to_process <span class="op">=</span> [<span class="st">"num_people"</span>, <span class="st">"num_people_men"</span>, <span class="st">"num_people_women"</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through columns</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> columns_to_process:</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create a copy of the column</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    dirty_numbers <span class="op">=</span> madrid_pop[column]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove "." from the numbers</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    clean_numbers <span class="op">=</span> dirty_numbers.<span class="bu">str</span>.replace(<span class="st">"."</span>, <span class="st">""</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert to numeric - coerce will convert non numeric values to NaN (Not a Number) or "null" types</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    numeric_numbers <span class="op">=</span> pd.to_numeric(clean_numbers, errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># overwrite the original column</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    madrid_pop[column] <span class="op">=</span> numeric_numbers</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>madrid_pop.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 912 entries, Centro to Barajas
Data columns (total 9 columns):
 #   Column              Non-Null Count  Dtype 
---  ------              --------------  ----- 
 0   date                912 non-null    object
 1   code_municipality   912 non-null    int64 
 2   municipality        912 non-null    object
 3   code_district       912 non-null    object
 4   code_neighbourhood  912 non-null    object
 5   neighbourhood       912 non-null    object
 6   num_people          912 non-null    int64 
 7   num_people_men      912 non-null    int64 
 8   num_people_women    912 non-null    int64 
dtypes: int64(4), object(5)
memory usage: 71.2+ KB</code></pre>
</div>
</div>
</section>
<section id="summary-statistics" class="level3">
<h3 class="anchored" data-anchor-id="summary-statistics">Summary Statistics</h3>
<div id="d2df5cbb" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>madrid_pop.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>912.0</td>
<td>912.000000</td>
<td>912.000000</td>
<td>912.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>28079.0</td>
<td>43336.804825</td>
<td>20210.739035</td>
<td>23126.065789</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.0</td>
<td>51564.255101</td>
<td>24072.657139</td>
<td>27522.444389</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>28079.0</td>
<td>945.000000</td>
<td>490.000000</td>
<td>455.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>28079.0</td>
<td>17330.500000</td>
<td>8132.000000</td>
<td>9267.250000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>28079.0</td>
<td>24700.500000</td>
<td>11580.000000</td>
<td>13640.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>28079.0</td>
<td>42166.500000</td>
<td>19700.250000</td>
<td>22349.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>28079.0</td>
<td>262339.000000</td>
<td>122632.000000</td>
<td>139707.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Note how the output is also a <code>DataFrame</code> object, so you can manipulate it the same way that you would with the original table (e.g.&nbsp;writing it to a file).</p>
<p>In this case, the summary might be better presented if the table is “transposed”:</p>
<div id="0ecae769" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>madrid_pop[columns_to_process].describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">num_people</td>
<td>912.0</td>
<td>43336.804825</td>
<td>51564.255101</td>
<td>945.0</td>
<td>17330.50</td>
<td>24700.5</td>
<td>42166.50</td>
<td>262339.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">num_people_men</td>
<td>912.0</td>
<td>20210.739035</td>
<td>24072.657139</td>
<td>490.0</td>
<td>8132.00</td>
<td>11580.0</td>
<td>19700.25</td>
<td>122632.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">num_people_women</td>
<td>912.0</td>
<td>23126.065789</td>
<td>27522.444389</td>
<td>455.0</td>
<td>9267.25</td>
<td>13640.0</td>
<td>22349.75</td>
<td>139707.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Equally, common descriptive statistics are also available. To obtain minimum values for each column, you can use <code>.min()</code>.</p>
<div id="e8106890" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>madrid_pop.<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>date                  1 de enero de 2018
code_municipality                  28079
municipality                      Madrid
code_district                          1
code_neighbourhood                     1
neighbourhood                 Arganzuela
num_people                           945
num_people_men                       490
num_people_women                     455
dtype: object</code></pre>
</div>
</div>
<p>Or to obtain a minimum for a single column only.</p>
<div id="e1cbab33" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>madrid_pop[<span class="st">"num_people_women"</span>].<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>455</code></pre>
</div>
</div>
<p>Note here how you have restricted the calculation of the minimum value to one column only by getting the <code>Series</code> and calling <code>.min()</code> on that.</p>
<p>Similarly, you can restrict the calculations to a single district using <code>.loc[]</code> indexer:</p>
<div id="1b209daa" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>madrid_pop.loc[<span class="st">"Centro"</span>].<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>date                  1 de enero de 2018
code_municipality                  28079
municipality                      Madrid
code_district                          1
code_neighbourhood                     1
neighbourhood                     Centro
num_people                          7201
num_people_men                      3672
num_people_women                    3529
dtype: object</code></pre>
</div>
</div>
<p>Let’s see when and where the said minimum occurred.</p>
<div id="cell-40" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can use comparators to index into the DataFrame where a specific column equals a specific value</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>madrid_pop[madrid_pop[<span class="st">"num_people_women"</span>] <span class="op">==</span> <span class="dv">3529</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centro</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>16</td>
<td>Sol</td>
<td>7201</td>
<td>3672</td>
<td>3529</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="create-new-columns" class="level3">
<h3 class="anchored" data-anchor-id="create-new-columns">Create new columns</h3>
<p>You can generate new variables by applying operations to existing ones. For example, you can calculate the ratio of women.</p>
<div id="cell-42" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ratio_women <span class="op">=</span> madrid_pop[<span class="st">"num_people_women"</span>] <span class="op">/</span> madrid_pop[<span class="st">"num_people"</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>ratio_women.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>district
Centro        0.493367
Arganzuela    0.531950
Retiro        0.546651
Salamanca     0.557645
Chamartín     0.549401
dtype: float64</code></pre>
</div>
</div>
<p>Once you have created the variable, you can make it part of the table:</p>
<div id="2d11ac4d" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>madrid_pop[<span class="st">"ratio_women"</span>] <span class="op">=</span> ratio_women</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>madrid_pop.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
<th data-quarto-table-cell-role="th">ratio_women</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>139687</td>
<td>70770</td>
<td>68917</td>
<td>0.493367</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Arganzuela</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>2</td>
<td>2</td>
<td>Arganzuela</td>
<td>153304</td>
<td>71754</td>
<td>81550</td>
<td>0.531950</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Retiro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>3</td>
<td>3</td>
<td>Retiro</td>
<td>117918</td>
<td>53458</td>
<td>64460</td>
<td>0.546651</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Salamanca</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>4</td>
<td>4</td>
<td>Salamanca</td>
<td>145702</td>
<td>64452</td>
<td>81250</td>
<td>0.557645</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Chamartín</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>5</td>
<td>5</td>
<td>Chamartín</td>
<td>144796</td>
<td>65245</td>
<td>79551</td>
<td>0.549401</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="index-based-queries" class="level3">
<h3 class="anchored" data-anchor-id="index-based-queries">Index-based queries</h3>
<p>Here, you explore how to subset parts of a <code>DataFrame</code> if you know exactly which bits you want.</p>
<p>For example, if you want to extract the “date”, “neighbourhood”, and “ratio_women” columns for the “Centro” and “Retiro” districts, you can use the Pandas <code>loc</code> indexer. Indexing in Pandas is very flexible and powerful, but can also be a bit confusing for the same reason. The <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html">loc documentation</a> and some back-and-forth with AI can be helpful in clearing up points of confusion!</p>
<div id="bf544d13" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>women_ratio_2districts <span class="op">=</span> madrid_pop.loc[</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Centro"</span>, <span class="st">"Retiro"</span>],  <span class="co"># the rows to retrieve</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"date"</span>, <span class="st">"neighbourhood"</span>, <span class="st">"ratio_women"</span>],  <span class="co"># the columns to retrieve</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>women_ratio_2districts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">ratio_women</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centro</td>
<td>1 de enero de 2023</td>
<td>Centro</td>
<td>0.493367</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Centro</td>
<td>1 de enero de 2023</td>
<td>Palacio</td>
<td>0.508234</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centro</td>
<td>1 de enero de 2023</td>
<td>Embajadores</td>
<td>0.478530</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Centro</td>
<td>1 de enero de 2023</td>
<td>Cortes</td>
<td>0.505362</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centro</td>
<td>1 de enero de 2023</td>
<td>Justicia</td>
<td>0.491685</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Retiro</td>
<td>1 de enero de 2018</td>
<td>Adelfas</td>
<td>0.540638</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Retiro</td>
<td>1 de enero de 2018</td>
<td>Estrella</td>
<td>0.535416</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Retiro</td>
<td>1 de enero de 2018</td>
<td>Ibiza</td>
<td>0.562966</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Retiro</td>
<td>1 de enero de 2018</td>
<td>LosJerónimos</td>
<td>0.531449</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Retiro</td>
<td>1 de enero de 2018</td>
<td>NiñoJesús</td>
<td>0.545746</td>
</tr>
</tbody>
</table>

<p>84 rows × 3 columns</p>
</div>
</div>
</div>
</div>
<p>You can see how you can create a list with the names (index IDs) along each of the two dimensions of a <code>DataFrame</code> (rows and columns), and <code>loc</code> will return a subset of the original table only with the elements queried for.</p>
<p>An alternative to list-based queries is what is called “range-based” queries. These work on the indices of the table, but instead of requiring the ID of each item you want to retrieve, they operate by requiring only two IDs: the first and last element in a range of items. Range queries are expressed with a colon (<code>:</code>). However, to perform this operation Index IDs need to be unique. Since this is not our case we will first create a new index composed the year and the <code>code_neighbourhood</code> as a new index to our DataFrame.</p>
<div id="cell-48" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset the index to move 'district' back to a regular column</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>madrid_pop.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the last 4 digits from the 'date' column and create a new 'year' column</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>madrid_pop[<span class="st">"year"</span>] <span class="op">=</span> madrid_pop[<span class="st">"date"</span>].<span class="bu">str</span>[<span class="op">-</span><span class="dv">4</span>:]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column with the combination of 'year' and 'code_neighbourhood'</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>madrid_pop[<span class="st">"new_index"</span>] <span class="op">=</span> madrid_pop[<span class="st">"year"</span>] <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> madrid_pop[<span class="st">"code_neighbourhood"</span>]</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set this as the new index</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>madrid_pop.set_index(<span class="st">"new_index"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>madrid_pop.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
<th data-quarto-table-cell-role="th">ratio_women</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">new_index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_1</td>
<td>Centro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>139687</td>
<td>70770</td>
<td>68917</td>
<td>0.493367</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023_2</td>
<td>Arganzuela</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>2</td>
<td>2</td>
<td>Arganzuela</td>
<td>153304</td>
<td>71754</td>
<td>81550</td>
<td>0.531950</td>
<td>2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_3</td>
<td>Retiro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>3</td>
<td>3</td>
<td>Retiro</td>
<td>117918</td>
<td>53458</td>
<td>64460</td>
<td>0.546651</td>
<td>2023</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Look at the order of the row and column indexes. This is important becuase “range-based” queries assume you understand the order and arrangement.</p>
<div id="5e25b1fb" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># return all content between rows "2019_1":"2018_1" and columns "num_people":"num_people_women"</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>range_query <span class="op">=</span> madrid_pop.loc[<span class="st">"2019_1"</span>:<span class="st">"2018_1"</span>, <span class="st">"num_people"</span>:<span class="st">"num_people_women"</span>]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>range_query</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">new_index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_1</td>
<td>134881</td>
<td>67829</td>
<td>67052</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_2</td>
<td>153830</td>
<td>71631</td>
<td>82199</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_3</td>
<td>119379</td>
<td>54098</td>
<td>65281</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_4</td>
<td>146148</td>
<td>64395</td>
<td>81753</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_5</td>
<td>145865</td>
<td>65565</td>
<td>80300</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_212</td>
<td>1851</td>
<td>952</td>
<td>899</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_213</td>
<td>7565</td>
<td>3648</td>
<td>3917</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_214</td>
<td>12388</td>
<td>5916</td>
<td>6472</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_215</td>
<td>7642</td>
<td>3746</td>
<td>3896</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018_1</td>
<td>132352</td>
<td>66320</td>
<td>66032</td>
</tr>
</tbody>
</table>

<p>153 rows × 3 columns</p>
</div>
</div>
</div>
</div>
<p>The range query picks up all the elements between the specified IDs. Note that for this to work, the first ID in the range needs to be placed before the second one in the table’s index.</p>
<p>Once you know about list and range-based queries, you can combine them!</p>
</section>
<section id="condition-based-queries" class="level3">
<h3 class="anchored" data-anchor-id="condition-based-queries">Condition-based queries</h3>
<p>However, sometimes, you do not know exactly which observations you want, but you do know what conditions they need to satisfy (e.g.&nbsp;areas with more than 2,000 inhabitants). For these cases, <code>DataFrames</code> support selection based on conditions. Let us see a few examples. Suppose you want to select…</p>
<p><em>… neighbourhoods wich over time have had less than 50% of women</em></p>
<div id="6df973c7" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fewer_women <span class="op">=</span> madrid_pop[madrid_pop[<span class="st">"ratio_women"</span>] <span class="op">&lt;</span> <span class="fl">0.5</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fewer_women</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
<th data-quarto-table-cell-role="th">ratio_women</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">new_index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_1</td>
<td>Centro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>139687</td>
<td>70770</td>
<td>68917</td>
<td>0.493367</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023_12</td>
<td>Centro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>12</td>
<td>Embajadores</td>
<td>46204</td>
<td>24094</td>
<td>22110</td>
<td>0.478530</td>
<td>2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_14</td>
<td>Centro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>14</td>
<td>Justicia</td>
<td>18219</td>
<td>9261</td>
<td>8958</td>
<td>0.491685</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023_16</td>
<td>Centro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>16</td>
<td>Sol</td>
<td>8164</td>
<td>4239</td>
<td>3925</td>
<td>0.480769</td>
<td>2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_81</td>
<td>Fuencarral-El Pardo</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>8</td>
<td>81</td>
<td>ElPardo</td>
<td>3421</td>
<td>1716</td>
<td>1705</td>
<td>0.498392</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023_106</td>
<td>Latina</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>106</td>
<td>CuatroVientos</td>
<td>6122</td>
<td>3068</td>
<td>3054</td>
<td>0.498857</td>
<td>2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_194</td>
<td>Vicálvaro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>19</td>
<td>194</td>
<td>ElCañaveral</td>
<td>13054</td>
<td>6652</td>
<td>6402</td>
<td>0.490424</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023_212</td>
<td>Barajas</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>212</td>
<td>Aeropuerto</td>
<td>1902</td>
<td>965</td>
<td>937</td>
<td>0.492639</td>
<td>2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022_1</td>
<td>Centro</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>139682</td>
<td>70986</td>
<td>68696</td>
<td>0.491803</td>
<td>2022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022_12</td>
<td>Centro</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>12</td>
<td>Embajadores</td>
<td>46444</td>
<td>24271</td>
<td>22173</td>
<td>0.477414</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022_14</td>
<td>Centro</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>14</td>
<td>Justicia</td>
<td>18015</td>
<td>9221</td>
<td>8794</td>
<td>0.488149</td>
<td>2022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022_16</td>
<td>Centro</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>16</td>
<td>Sol</td>
<td>8117</td>
<td>4232</td>
<td>3885</td>
<td>0.478625</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022_106</td>
<td>Latina</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>106</td>
<td>CuatroVientos</td>
<td>5966</td>
<td>2996</td>
<td>2970</td>
<td>0.497821</td>
<td>2022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022_194</td>
<td>Vicálvaro</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>19</td>
<td>194</td>
<td>ElCañaveral</td>
<td>8944</td>
<td>4525</td>
<td>4419</td>
<td>0.494074</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022_212</td>
<td>Barajas</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>212</td>
<td>Aeropuerto</td>
<td>1895</td>
<td>967</td>
<td>928</td>
<td>0.489710</td>
<td>2022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021_1</td>
<td>Centro</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>141236</td>
<td>71881</td>
<td>69355</td>
<td>0.491058</td>
<td>2021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021_12</td>
<td>Centro</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>12</td>
<td>Embajadores</td>
<td>47238</td>
<td>24767</td>
<td>22471</td>
<td>0.475698</td>
<td>2021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021_14</td>
<td>Centro</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>14</td>
<td>Justicia</td>
<td>18208</td>
<td>9291</td>
<td>8917</td>
<td>0.489730</td>
<td>2021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021_16</td>
<td>Centro</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>16</td>
<td>Sol</td>
<td>7993</td>
<td>4120</td>
<td>3873</td>
<td>0.484549</td>
<td>2021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021_81</td>
<td>Fuencarral-El Pardo</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>8</td>
<td>81</td>
<td>ElPardo</td>
<td>3443</td>
<td>1723</td>
<td>1720</td>
<td>0.499564</td>
<td>2021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021_194</td>
<td>Vicálvaro</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>19</td>
<td>194</td>
<td>ElCañaveral</td>
<td>4430</td>
<td>2254</td>
<td>2176</td>
<td>0.491196</td>
<td>2021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021_212</td>
<td>Barajas</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>212</td>
<td>Aeropuerto</td>
<td>1918</td>
<td>988</td>
<td>930</td>
<td>0.484880</td>
<td>2021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020_1</td>
<td>Centro</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>140473</td>
<td>71127</td>
<td>69346</td>
<td>0.493661</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020_12</td>
<td>Centro</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>12</td>
<td>Embajadores</td>
<td>47048</td>
<td>24497</td>
<td>22551</td>
<td>0.479319</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020_14</td>
<td>Centro</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>14</td>
<td>Justicia</td>
<td>18021</td>
<td>9161</td>
<td>8860</td>
<td>0.491649</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020_16</td>
<td>Centro</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>16</td>
<td>Sol</td>
<td>7622</td>
<td>3895</td>
<td>3727</td>
<td>0.488979</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020_106</td>
<td>Latina</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>106</td>
<td>CuatroVientos</td>
<td>5881</td>
<td>2958</td>
<td>2923</td>
<td>0.497024</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020_194</td>
<td>Vicálvaro</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>19</td>
<td>194</td>
<td>ElCañaveral</td>
<td>2398</td>
<td>1230</td>
<td>1168</td>
<td>0.487073</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020_212</td>
<td>Barajas</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>212</td>
<td>Aeropuerto</td>
<td>1900</td>
<td>975</td>
<td>925</td>
<td>0.486842</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_1</td>
<td>Centro</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>134881</td>
<td>67829</td>
<td>67052</td>
<td>0.497120</td>
<td>2019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_12</td>
<td>Centro</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>12</td>
<td>Embajadores</td>
<td>45259</td>
<td>23390</td>
<td>21869</td>
<td>0.483197</td>
<td>2019</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_14</td>
<td>Centro</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>14</td>
<td>Justicia</td>
<td>17153</td>
<td>8675</td>
<td>8478</td>
<td>0.494258</td>
<td>2019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_16</td>
<td>Centro</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>16</td>
<td>Sol</td>
<td>7337</td>
<td>3749</td>
<td>3588</td>
<td>0.489028</td>
<td>2019</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_106</td>
<td>Latina</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>106</td>
<td>CuatroVientos</td>
<td>5748</td>
<td>2909</td>
<td>2839</td>
<td>0.493911</td>
<td>2019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_194</td>
<td>Vicálvaro</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>19</td>
<td>194</td>
<td>ElCañaveral</td>
<td>1530</td>
<td>785</td>
<td>745</td>
<td>0.486928</td>
<td>2019</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_212</td>
<td>Barajas</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>212</td>
<td>Aeropuerto</td>
<td>1851</td>
<td>952</td>
<td>899</td>
<td>0.485683</td>
<td>2019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018_1</td>
<td>Centro</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>132352</td>
<td>66320</td>
<td>66032</td>
<td>0.498912</td>
<td>2018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018_12</td>
<td>Centro</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>12</td>
<td>Embajadores</td>
<td>44630</td>
<td>23031</td>
<td>21599</td>
<td>0.483957</td>
<td>2018</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018_14</td>
<td>Centro</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>14</td>
<td>Justicia</td>
<td>16578</td>
<td>8334</td>
<td>8244</td>
<td>0.497286</td>
<td>2018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018_16</td>
<td>Centro</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>16</td>
<td>Sol</td>
<td>7201</td>
<td>3672</td>
<td>3529</td>
<td>0.490071</td>
<td>2018</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018_106</td>
<td>Latina</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>106</td>
<td>CuatroVientos</td>
<td>5662</td>
<td>2870</td>
<td>2792</td>
<td>0.493112</td>
<td>2018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018_194</td>
<td>Vicálvaro</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>19</td>
<td>194</td>
<td>ElCañaveral</td>
<td>945</td>
<td>490</td>
<td>455</td>
<td>0.481481</td>
<td>2018</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018_212</td>
<td>Barajas</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>21</td>
<td>212</td>
<td>Aeropuerto</td>
<td>1794</td>
<td>922</td>
<td>872</td>
<td>0.486065</td>
<td>2018</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p><em>… most populated area across all years:</em></p>
<div id="cell-55" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>largest_hood_num <span class="op">=</span> madrid_pop[<span class="st">"num_people"</span>].<span class="bu">max</span>()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>largest_hood <span class="op">=</span> madrid_pop[madrid_pop[<span class="st">"num_people"</span>] <span class="op">==</span> largest_hood_num]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>largest_hood</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
<th data-quarto-table-cell-role="th">ratio_women</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">new_index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_11</td>
<td>Carabanchel</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>11</td>
<td>11</td>
<td>Carabanchel</td>
<td>262339</td>
<td>122632</td>
<td>139707</td>
<td>0.532544</td>
<td>2023</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>If you are interested, more detail about <code>query</code> is available in the <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#the-query-method">pandas documentation</a>. This is another way of slicing Dataframes, but for now we will stay with the <code>loc</code> function.</p>
</section>
<section id="combining-queries" class="level3">
<h3 class="anchored" data-anchor-id="combining-queries">Combining queries</h3>
<p>Now, all of these queries can be combined with each other for further flexibility. For example, imagine you want to know the areas that have more than 100K inhabitants and have over 50% of women.</p>
<div id="1a7ffaca" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>women_power <span class="op">=</span> madrid_pop.loc[</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the &amp; symbol will combine True conditions for the left result set</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># with the True conditions from the right result set</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># there is also an "or" operator which uses the "Pipe" symbol "|" instead</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    (madrid_pop[<span class="st">"num_people_women"</span>] <span class="op">&gt;</span> <span class="dv">100000</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (madrid_pop[<span class="st">"ratio_women"</span>] <span class="op">&gt;</span> <span class="fl">0.5</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>women_power</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
<th data-quarto-table-cell-role="th">ratio_women</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">new_index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_8</td>
<td>Fuencarral-El Pardo</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>8</td>
<td>8</td>
<td>Fuencarral-El Pardo</td>
<td>248443</td>
<td>116944</td>
<td>131499</td>
<td>0.529292</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023_10</td>
<td>Latina</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>10</td>
<td>Latina</td>
<td>241672</td>
<td>112093</td>
<td>129579</td>
<td>0.536177</td>
<td>2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_11</td>
<td>Carabanchel</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>11</td>
<td>11</td>
<td>Carabanchel</td>
<td>262339</td>
<td>122632</td>
<td>139707</td>
<td>0.532544</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023_13</td>
<td>Puente de Vallecas</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>13</td>
<td>13</td>
<td>Puente de Vallecas</td>
<td>241603</td>
<td>114542</td>
<td>127061</td>
<td>0.525908</td>
<td>2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_15</td>
<td>Ciudad Lineal</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>15</td>
<td>15</td>
<td>Ciudad Lineal</td>
<td>220345</td>
<td>100759</td>
<td>119586</td>
<td>0.542722</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023_16</td>
<td>Hortaleza</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>16</td>
<td>16</td>
<td>Hortaleza</td>
<td>198391</td>
<td>94100</td>
<td>104291</td>
<td>0.525684</td>
<td>2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022_8</td>
<td>Fuencarral-El Pardo</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>8</td>
<td>8</td>
<td>Fuencarral-El Pardo</td>
<td>246281</td>
<td>115955</td>
<td>130326</td>
<td>0.529176</td>
<td>2022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022_10</td>
<td>Latina</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>10</td>
<td>Latina</td>
<td>237048</td>
<td>109928</td>
<td>127120</td>
<td>0.536263</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022_11</td>
<td>Carabanchel</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>11</td>
<td>11</td>
<td>Carabanchel</td>
<td>255514</td>
<td>119381</td>
<td>136133</td>
<td>0.532781</td>
<td>2022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022_13</td>
<td>Puente de Vallecas</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>13</td>
<td>13</td>
<td>Puente de Vallecas</td>
<td>235638</td>
<td>111748</td>
<td>123890</td>
<td>0.525764</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022_15</td>
<td>Ciudad Lineal</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>15</td>
<td>15</td>
<td>Ciudad Lineal</td>
<td>213905</td>
<td>97357</td>
<td>116548</td>
<td>0.544859</td>
<td>2022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022_16</td>
<td>Hortaleza</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>16</td>
<td>16</td>
<td>Hortaleza</td>
<td>195017</td>
<td>92532</td>
<td>102485</td>
<td>0.525518</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021_8</td>
<td>Fuencarral-El Pardo</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>8</td>
<td>8</td>
<td>Fuencarral-ElPardo</td>
<td>247692</td>
<td>116520</td>
<td>131172</td>
<td>0.529577</td>
<td>2021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021_10</td>
<td>Latina</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>10</td>
<td>Latina</td>
<td>240155</td>
<td>111209</td>
<td>128946</td>
<td>0.536928</td>
<td>2021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021_11</td>
<td>Carabanchel</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>11</td>
<td>11</td>
<td>Carabanchel</td>
<td>258633</td>
<td>120600</td>
<td>138033</td>
<td>0.533702</td>
<td>2021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021_13</td>
<td>Puente de Vallecas</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>13</td>
<td>13</td>
<td>PuentedeVallecas</td>
<td>239057</td>
<td>113355</td>
<td>125702</td>
<td>0.525824</td>
<td>2021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021_15</td>
<td>Ciudad Lineal</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>15</td>
<td>15</td>
<td>CiudadLineal</td>
<td>216818</td>
<td>98514</td>
<td>118304</td>
<td>0.545637</td>
<td>2021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021_16</td>
<td>Hortaleza</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>16</td>
<td>16</td>
<td>Hortaleza</td>
<td>193228</td>
<td>91585</td>
<td>101643</td>
<td>0.526026</td>
<td>2021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020_8</td>
<td>Fuencarral-El Pardo</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>8</td>
<td>8</td>
<td>Fuencarral-ElPardo</td>
<td>249973</td>
<td>117640</td>
<td>132333</td>
<td>0.529389</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020_10</td>
<td>Latina</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>10</td>
<td>Latina</td>
<td>242139</td>
<td>112282</td>
<td>129857</td>
<td>0.536291</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020_11</td>
<td>Carabanchel</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>11</td>
<td>11</td>
<td>Carabanchel</td>
<td>260196</td>
<td>121317</td>
<td>138879</td>
<td>0.533748</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020_13</td>
<td>Puente de Vallecas</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>13</td>
<td>13</td>
<td>PuentedeVallecas</td>
<td>240867</td>
<td>114235</td>
<td>126632</td>
<td>0.525734</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020_15</td>
<td>Ciudad Lineal</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>15</td>
<td>15</td>
<td>CiudadLineal</td>
<td>219867</td>
<td>99966</td>
<td>119901</td>
<td>0.545334</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020_16</td>
<td>Hortaleza</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>16</td>
<td>16</td>
<td>Hortaleza</td>
<td>193264</td>
<td>91659</td>
<td>101605</td>
<td>0.525732</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_8</td>
<td>Fuencarral-El Pardo</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>8</td>
<td>8</td>
<td>Fuencarral-ElPardo</td>
<td>246021</td>
<td>115797</td>
<td>130224</td>
<td>0.529321</td>
<td>2019</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_10</td>
<td>Latina</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>10</td>
<td>Latina</td>
<td>238154</td>
<td>110401</td>
<td>127753</td>
<td>0.536430</td>
<td>2019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_11</td>
<td>Carabanchel</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>11</td>
<td>11</td>
<td>Carabanchel</td>
<td>253040</td>
<td>117802</td>
<td>135238</td>
<td>0.534453</td>
<td>2019</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_13</td>
<td>Puente de Vallecas</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>13</td>
<td>13</td>
<td>PuentedeVallecas</td>
<td>234770</td>
<td>111183</td>
<td>123587</td>
<td>0.526417</td>
<td>2019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_15</td>
<td>Ciudad Lineal</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>15</td>
<td>15</td>
<td>CiudadLineal</td>
<td>216270</td>
<td>98370</td>
<td>117900</td>
<td>0.545152</td>
<td>2019</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018_8</td>
<td>Fuencarral-El Pardo</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>8</td>
<td>8</td>
<td>Fuencarral-ElPardo</td>
<td>242928</td>
<td>114433</td>
<td>128495</td>
<td>0.528943</td>
<td>2018</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018_10</td>
<td>Latina</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>10</td>
<td>10</td>
<td>Latina</td>
<td>235785</td>
<td>109392</td>
<td>126393</td>
<td>0.536052</td>
<td>2018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018_11</td>
<td>Carabanchel</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>11</td>
<td>11</td>
<td>Carabanchel</td>
<td>248220</td>
<td>115525</td>
<td>132695</td>
<td>0.534586</td>
<td>2018</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018_13</td>
<td>Puente de Vallecas</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>13</td>
<td>13</td>
<td>PuentedeVallecas</td>
<td>230488</td>
<td>109044</td>
<td>121444</td>
<td>0.526899</td>
<td>2018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018_15</td>
<td>Ciudad Lineal</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>15</td>
<td>15</td>
<td>CiudadLineal</td>
<td>214463</td>
<td>97301</td>
<td>117162</td>
<td>0.546304</td>
<td>2018</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="sorting" class="level3">
<h3 class="anchored" data-anchor-id="sorting">Sorting</h3>
<p>Among the many operations <code>DataFrame</code> objects support, one of the most useful ones is to sort a table based on a given column. For example, imagine you want to sort the table by the ratio of women:</p>
<div id="855ffda5" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>madrid_sorted <span class="op">=</span> madrid_pop.sort_values(<span class="st">"ratio_women"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>madrid_sorted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
<th data-quarto-table-cell-role="th">ratio_women</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">new_index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018_158</td>
<td>Ciudad Lineal</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>15</td>
<td>158</td>
<td>Atalaya</td>
<td>1575</td>
<td>656</td>
<td>919</td>
<td>0.583492</td>
<td>2018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_158</td>
<td>Ciudad Lineal</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>15</td>
<td>158</td>
<td>Atalaya</td>
<td>1568</td>
<td>654</td>
<td>914</td>
<td>0.582908</td>
<td>2019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_158</td>
<td>Ciudad Lineal</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>15</td>
<td>158</td>
<td>Atalaya</td>
<td>1622</td>
<td>691</td>
<td>931</td>
<td>0.573983</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020_158</td>
<td>Ciudad Lineal</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>15</td>
<td>158</td>
<td>Atalaya</td>
<td>1555</td>
<td>667</td>
<td>888</td>
<td>0.571061</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020_45</td>
<td>Salamanca</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>4</td>
<td>45</td>
<td>Lista</td>
<td>21211</td>
<td>9111</td>
<td>12100</td>
<td>0.570459</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020_12</td>
<td>Centro</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>12</td>
<td>Embajadores</td>
<td>47048</td>
<td>24497</td>
<td>22551</td>
<td>0.479319</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022_16</td>
<td>Centro</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>16</td>
<td>Sol</td>
<td>8117</td>
<td>4232</td>
<td>3885</td>
<td>0.478625</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_12</td>
<td>Centro</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>12</td>
<td>Embajadores</td>
<td>46204</td>
<td>24094</td>
<td>22110</td>
<td>0.478530</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022_12</td>
<td>Centro</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>12</td>
<td>Embajadores</td>
<td>46444</td>
<td>24271</td>
<td>22173</td>
<td>0.477414</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021_12</td>
<td>Centro</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>12</td>
<td>Embajadores</td>
<td>47238</td>
<td>24767</td>
<td>22471</td>
<td>0.475698</td>
<td>2021</td>
</tr>
</tbody>
</table>

<p>912 rows × 12 columns</p>
</div>
</div>
</div>
</div>
<p>Given the rates differ, it may be better to sort by neighbourhood and then by year.</p>
<div id="cell-62" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sort_ls <span class="op">=</span> [<span class="st">"code_neighbourhood"</span>, <span class="st">"year"</span>]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>madrid_sorted <span class="op">=</span> madrid_pop.sort_values(sort_ls, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>madrid_sorted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">municipality</th>
<th data-quarto-table-cell-role="th">code_district</th>
<th data-quarto-table-cell-role="th">code_neighbourhood</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
<th data-quarto-table-cell-role="th">ratio_women</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">new_index</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018_1</td>
<td>Centro</td>
<td>1 de enero de 2018</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>132352</td>
<td>66320</td>
<td>66032</td>
<td>0.498912</td>
<td>2018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019_1</td>
<td>Centro</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>134881</td>
<td>67829</td>
<td>67052</td>
<td>0.497120</td>
<td>2019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020_1</td>
<td>Centro</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>140473</td>
<td>71127</td>
<td>69346</td>
<td>0.493661</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021_1</td>
<td>Centro</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>141236</td>
<td>71881</td>
<td>69355</td>
<td>0.491058</td>
<td>2021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022_1</td>
<td>Centro</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>1</td>
<td>1</td>
<td>Centro</td>
<td>139682</td>
<td>70986</td>
<td>68696</td>
<td>0.491803</td>
<td>2022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019_97</td>
<td>Moncloa-Aravaca</td>
<td>1 de enero de 2019</td>
<td>28079</td>
<td>Madrid</td>
<td>9</td>
<td>97</td>
<td>Aravaca</td>
<td>26823</td>
<td>12619</td>
<td>14204</td>
<td>0.529546</td>
<td>2019</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020_97</td>
<td>Moncloa-Aravaca</td>
<td>1 de enero de 2020</td>
<td>28079</td>
<td>Madrid</td>
<td>9</td>
<td>97</td>
<td>Aravaca</td>
<td>27503</td>
<td>12899</td>
<td>14604</td>
<td>0.530997</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2021_97</td>
<td>Moncloa-Aravaca</td>
<td>1 de enero de 2021</td>
<td>28079</td>
<td>Madrid</td>
<td>9</td>
<td>97</td>
<td>Aravaca</td>
<td>27568</td>
<td>12896</td>
<td>14672</td>
<td>0.532211</td>
<td>2021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2022_97</td>
<td>Moncloa-Aravaca</td>
<td>1 de enero de 2022</td>
<td>28079</td>
<td>Madrid</td>
<td>9</td>
<td>97</td>
<td>Aravaca</td>
<td>27323</td>
<td>12779</td>
<td>14544</td>
<td>0.532299</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023_97</td>
<td>Moncloa-Aravaca</td>
<td>1 de enero de 2023</td>
<td>28079</td>
<td>Madrid</td>
<td>9</td>
<td>97</td>
<td>Aravaca</td>
<td>27445</td>
<td>12836</td>
<td>14609</td>
<td>0.532301</td>
<td>2023</td>
</tr>
</tbody>
</table>

<p>912 rows × 12 columns</p>
</div>
</div>
</div>
</div>
<p>This allows you to do so-called hierarchical sorting: sort first based on one column then based on another.</p>
</section>
</section>
<section id="visual-exploration" class="level2">
<h2 class="anchored" data-anchor-id="visual-exploration">Visual Exploration</h2>
<p>The next step to continue exploring a dataset is to get a feel for what it looks like, visually. We have already learnt how to uncover and inspect specific parts of the data to check for particular cases we might be interested in. Now, we will see how to plot the data to get a sense of the overall distribution of values. For that, we can use the plotting capabilities of <code>pandas</code>.</p>
<section id="histograms" class="level3">
<h3 class="anchored" data-anchor-id="histograms">Histograms</h3>
<p>One of the most common graphical devices to display the distribution of values in a variable is a histogram. Values are assigned into groups of equal intervals, and the groups are plotted as bars rising as high as the number of values into the group.</p>
<p>A histogram is easily created with the following command. In this case, let’s have a look at the shape of the overall numbers of people:</p>
<div id="cell-65" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>madrid_pop[<span class="st">"num_people"</span>].plot.hist(bins<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>However, the default <code>pandas</code> plots can be a bit dull. A better option is to use another package, called <a href="https://seaborn.pydata.org"><code>seaborn</code></a>.</p>
<p><code>seaborn</code> is, by convention, imported as <code>sns</code>. Seaborn is a humorous reference to <a href="https://en.wikipedia.org/wiki/Sam_Seaborn">Samuel Normal Seaborn</a>, a fictional character The West Wing show.</p>
<p>The same plot using <code>seaborn</code> has more agreeable default styles and more customisability.</p>
<div id="eea1013e" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the style</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"darkgrid"</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>sns.histplot(madrid_pop[<span class="st">"num_people"</span>], kde<span class="op">=</span><span class="va">True</span>, bins<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note we are using <code>sns</code> instead of <code>pd</code>, as the function belongs to <code>seaborn</code> instead of <code>pandas</code>.</p>
<p>We can quickly see most of the areas have seen somewhere between 0 and 50K people; and very few have more than 200K. However, remember that in this case we are visualizing all years together, which could lead to misinterpretations.</p>
</section>
<section id="line-and-bar-plots" class="level3">
<h3 class="anchored" data-anchor-id="line-and-bar-plots">Line and bar plots</h3>
<p>Another very common way of visually displaying a variable is with a line or a bar chart. For example, if you want to generate a line plot of the (sorted) total population per year:</p>
<div id="cell-70" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>total_people_per_year <span class="op">=</span> madrid_pop.groupby(<span class="st">"year"</span>)[<span class="st">"num_people"</span>].<span class="bu">sum</span>()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>total_people_per_year.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>What is evident is the impact of COVID on the total population. But understanding that the data is reported on the 1st of January of each year is crucial to understand why you see the offset on the dates.</p>
<p>For a bar plot all you need to do is to change from <code>plot</code> to <code>plot.bar</code>:</p>
<div id="cell-72" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>total_people_per_year.plot.bar()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Let’s try to plot the <code>ratio_women</code> per neighbourhood, to see if we spot anything in particular.</p>
<div id="cell-74" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"year"</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"ratio_women"</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"neighbourhood"</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>madrid_pop.sort_values(<span class="st">"year"</span>, ascending<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pandas_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see some outliers, but the reality is that the data is hard to read so we probably would need some further analysis and visual considerations to efficiently communicate any possible trends.</p>
</section>
</section>
<section id="tidy-data" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data">Tidy data</h2>
<blockquote class="blockquote">
<p><strong>Clean vs.&nbsp;Tidy</strong></p>
<p>This section is a bit more advanced and hence considered optional. Feel free to skip it and return later when you feel more confident.</p>
</blockquote>
<p>Once you can read your data in, explore specific cases, and have a first visual approach to the entire set, the next step can be preparing it for more sophisticated analysis. Maybe you are thinking of modelling it through regression, or on creating subgroups in the dataset with particular characteristics, or maybe you simply need to present summary measures that relate to a slightly different arrangement of the data than you have been presented with.</p>
<p>For all these cases, you first need what statistician, and general R wizard, Hadley Wickham calls <em>“tidy data”</em>. The general idea to “tidy” your data is to convert them from whatever structure they were handed to you into one that allows convenient and standardized manipulation, and that supports directly inputting the data into what he calls “<em>tidy</em>” analysis tools. But, at a more practical level, what is exactly <em>“tidy data”</em>? In Wickham’s own words:</p>
<blockquote class="blockquote">
<p><em>Tidy data is a standard way of mapping the meaning of a dataset to its structure. A dataset is messy or tidy depending on how rows, columns and tables are matched up with observations, variables and types.</em></p>
</blockquote>
<p>He then goes on to list the three fundamental characteristics of <em>“tidy data”</em>:</p>
<ol type="1">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ol>
<p>If you are further interested in the concept of <em>“tidy data”</em>, we recommend the <a href="http://www.jstatsoft.org/v59/i10/">original paper</a> (open access) and the associated <a href="https://github.com/hadley/tidy-data">public repository</a>.</p>
</section>
<section id="grouping-transforming-aggregating" class="level2">
<h2 class="anchored" data-anchor-id="grouping-transforming-aggregating">Grouping, transforming, aggregating</h2>
<p>One of the advantage of tidy datasets is they allow advanced transformations in a more direct way. One of the most common ones is what is called “group-by” operations. These originated in the world of databases, and allow you to group observations from a data table by labels, index, or category, and to then apply operations on the data on a group by group basis.</p>
<p>For example, given our <code>DataFrame</code>, we might want to compute the total sum of the population by each district. This task can be split into two different steps:</p>
<ul>
<li>Group the table in each of the different districts.</li>
<li>Compute the sum of <code>num_people</code> for each of them.</li>
</ul>
<p>To do this in <code>pandas</code>, meet one of its workhorses and also one of the reasons why the library has become so popular: the <code>groupby</code> operator.</p>
<div id="cell-78" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>mad_grouped <span class="op">=</span> madrid_pop.groupby(<span class="st">"year"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>mad_grouped</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x1442cc850&gt;</code></pre>
</div>
</div>
<p>The object <code>mad_grouped</code> still hasn’t computed anything. It is only a convenient way of specifying the grouping. But this allows us then to perform a multitude of operations on it. For our example, the sum is calculated as follows:</p>
<div id="8ce0826b" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mad_grouped.<span class="bu">sum</span>(numeric_only<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">code_municipality</th>
<th data-quarto-table-cell-role="th">num_people</th>
<th data-quarto-table-cell-role="th">num_people_men</th>
<th data-quarto-table-cell-role="th">num_people_women</th>
<th data-quarto-table-cell-role="th">ratio_women</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018</td>
<td>4268008</td>
<td>6443648</td>
<td>3000680</td>
<td>3442968</td>
<td>81.100391</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019</td>
<td>4268008</td>
<td>6532252</td>
<td>3042356</td>
<td>3489896</td>
<td>81.108315</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020</td>
<td>4268008</td>
<td>6669460</td>
<td>3109464</td>
<td>3559996</td>
<td>81.047788</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021</td>
<td>4268008</td>
<td>6624620</td>
<td>3090314</td>
<td>3534306</td>
<td>81.013452</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022</td>
<td>4268008</td>
<td>6573324</td>
<td>3069648</td>
<td>3503676</td>
<td>80.939052</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023</td>
<td>4268008</td>
<td>6679862</td>
<td>3119732</td>
<td>3560130</td>
<td>80.942860</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Similarly, we can also obtain a summary of each group:</p>
<div id="c79783a2" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mad_grouped.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="8" data-quarto-table-cell-role="th" data-halign="left">code_municipality</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">num_people</th>
<th data-quarto-table-cell-role="th">...</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">num_people_women</th>
<th colspan="8" data-quarto-table-cell-role="th" data-halign="left">ratio_women</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018</td>
<td>152.0</td>
<td>28079.0</td>
<td>0.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>152.0</td>
<td>42392.421053</td>
<td>...</td>
<td>21771.75</td>
<td>132695.0</td>
<td>152.0</td>
<td>0.533555</td>
<td>0.018390</td>
<td>0.481481</td>
<td>0.521591</td>
<td>0.534767</td>
<td>0.545880</td>
<td>0.583492</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019</td>
<td>152.0</td>
<td>28079.0</td>
<td>0.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>152.0</td>
<td>42975.342105</td>
<td>...</td>
<td>21987.00</td>
<td>135238.0</td>
<td>152.0</td>
<td>0.533607</td>
<td>0.018198</td>
<td>0.483197</td>
<td>0.522356</td>
<td>0.534355</td>
<td>0.545650</td>
<td>0.582908</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020</td>
<td>152.0</td>
<td>28079.0</td>
<td>0.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>152.0</td>
<td>43878.026316</td>
<td>...</td>
<td>22623.75</td>
<td>138879.0</td>
<td>152.0</td>
<td>0.533209</td>
<td>0.017944</td>
<td>0.479319</td>
<td>0.522586</td>
<td>0.533905</td>
<td>0.545599</td>
<td>0.571061</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2021</td>
<td>152.0</td>
<td>28079.0</td>
<td>0.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>152.0</td>
<td>43583.026316</td>
<td>...</td>
<td>22530.75</td>
<td>138033.0</td>
<td>152.0</td>
<td>0.532983</td>
<td>0.017984</td>
<td>0.475698</td>
<td>0.522263</td>
<td>0.533724</td>
<td>0.545682</td>
<td>0.568987</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2022</td>
<td>152.0</td>
<td>28079.0</td>
<td>0.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>152.0</td>
<td>43245.552632</td>
<td>...</td>
<td>22296.50</td>
<td>136133.0</td>
<td>152.0</td>
<td>0.532494</td>
<td>0.017716</td>
<td>0.477414</td>
<td>0.521691</td>
<td>0.533305</td>
<td>0.544920</td>
<td>0.567140</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023</td>
<td>152.0</td>
<td>28079.0</td>
<td>0.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>28079.0</td>
<td>152.0</td>
<td>43946.460526</td>
<td>...</td>
<td>22742.75</td>
<td>139707.0</td>
<td>152.0</td>
<td>0.532519</td>
<td>0.017486</td>
<td>0.478530</td>
<td>0.522637</td>
<td>0.533363</td>
<td>0.544488</td>
<td>0.573983</td>
</tr>
</tbody>
</table>

<p>6 rows × 40 columns</p>
</div>
</div>
</div>
</div>
<p>We will not get into it today as it goes beyond the basics this chapter covers, but keep in mind that <code>groupby</code> allows us to not only call generic functions (like <code>sum</code> or <code>describe</code>), but also custom functions. This opens the door for virtually any kind of transformation and aggregation possible.</p>
<p><strong>Additional reading</strong></p>
<ul>
<li>A good introduction to data manipulation in Python is Wes McKinney’s <a href="https://wesmckinney.com/book/pandas-basics">Python for Data Analysis</a>.</li>
<li>To further explore some of the visualization capabilities, the Python library <code>seaborn</code> is an excellent choice. Its online <a href="https://seaborn.pydata.org/tutorial.html">tutorial</a> is a fantastic place to start.</li>
<li>A good extension is Hadley Wickham’s “Tidy data” paper, which presents a very popular way of organising tabular data for efficient manipulation.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/Norman-Foster-Institute/ua_2024/blob/main/LICENSE">
<p>License</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>