<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>NFI Urban Analytics 2024 - Part 1 - Welcome to GeoPandas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapter_2/open_source.html" rel="prev">
<link href=".././assets/nfi_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../custom-style.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">NFI Urban Analytics 2024 - Part 1</span>
    </a>
  </div>
        <div class="quarto-navbar-tools">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapter_2/intro_to_python.html">Basic Coding</a></li><li class="breadcrumb-item"><a href="../chapter_2/intro_to_geopandas.html">Welcome to GeoPandas</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src=".././assets/nfi_logo_txt.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/Norman-Foster-Institute/ua_2024" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Setup</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_0/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_0/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Software &amp; Accounts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_0/anaconda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python Notebooks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">GIS Tools</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/gis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to GIS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/qgis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to QGIS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/qgis_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QGIS Mapping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/gis_tips.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_1/cloud_gis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cloud GIS</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Basic Coding</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_2/intro_to_python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_2/open_source.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Open Source</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapter_2/intro_to_geopandas.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Welcome to GeoPandas</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li><a href="#opening-files" id="toc-opening-files" class="nav-link" data-scroll-target="#opening-files">Opening files</a></li>
  <li><a href="#opening-geospatial-files" id="toc-opening-geospatial-files" class="nav-link" data-scroll-target="#opening-geospatial-files">Opening geospatial files</a></li>
  <li><a href="#linkages" id="toc-linkages" class="nav-link" data-scroll-target="#linkages">Linkages</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapter_2/intro_to_python.html">Basic Coding</a></li><li class="breadcrumb-item"><a href="../chapter_2/intro_to_geopandas.html">Welcome to GeoPandas</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Welcome to GeoPandas</h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Last update</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">February 18, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>NOTE: this lesson is under development, please check back later!</p>
</blockquote>
<p>In the <a href="../chapter_2/intro_to_python.html">Intro to Python</a> lesson (do that lesson first if you haven’t already) we provided a high level introduction to GeoPandas. GeoPandas builds on underlying functionality provided by a library called “Pandas”. Put differently, GeoPandas bolts geospatial capabilities onto the underlying Pandas library.</p>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>We’ll be using demo census data from Eustat-Basque Institute of Statistics, <a href="https://www.eustat.eus/elementos/tbl0011435_c.html">accessed from here</a>: Population by districts and census sections of Bizkaia, according to sex, age groups and nationality. This workflow should work for other files downloaded from this source.</p>
<p>Ordinarily, we’d like to use <code>csv</code> data. However, if you download and inspect the <code>csv</code> file’s contents then you’d notice that something seems off. <code>csv</code> files need consistently formatted cell delimitations to work as intended, yet this file seems to have multiple header lines with different hierarchies of delimitation. You’ll also notice that every few lines seems to have a different structure. Let’s download the <code>xlsx</code> instead. If we inspect the file, we can now see that this is a hierarchically organised tabular structure.</p>
<ul>
<li>The <a href="./data/bilbao_census_geoms.gpkg">census boundaries</a> are the standard census statistical units for the region.</li>
</ul>
</section>
<section id="opening-files" class="level2">
<h2 class="anchored" data-anchor-id="opening-files">Opening files</h2>
<p>Install <code>pandas</code> if necessary, and, since we need to read excel files, we’ll also need to check that <code>openpyxl</code> is installed.</p>
<div id="2de4c269" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uncomment to install</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install pandas openpyxl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s import GeoPandas into our working notebook.</p>
<div id="5c00c572" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You’ll need to update the filepath to point to your data file location.</p>
<div id="a08686bc" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df_excel <span class="op">=</span> pd.read_excel(<span class="st">'./data/xls0011435_c.xlsx'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_excel.head(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                          Unnamed: 0 Unnamed: 1 Unnamed: 2  \
0  Población por distritos y secciones censales d...        NaN        NaN   
1                                                NaN        NaN        NaN   
2                                                NaN        NaN        NaN   
3                                                NaN        NaN        NaN   
4                                                NaN        NaN        NaN   
5                                                Cod  Municipio       Dist   
6                                                001    Abadiño         01   
7                                                NaN        NaN        NaN   
8                                                NaN        NaN        NaN   
9                                                NaN        NaN        NaN   

  Unnamed: 3               Unnamed: 4 Unnamed: 5 Unnamed: 6 Unnamed: 7  \
0        NaN                      NaN        NaN        NaN        NaN   
1        NaN                      NaN        NaN        NaN        NaN   
2        NaN                      NaN        NaN        NaN        NaN   
3        NaN  Población según el sexo        NaN        NaN        NaN   
4        NaN                    Total    Hombres    Mujeres  Sex ratio   
5       Secc                      NaN        NaN        NaN        NaN   
6        000                     7745       3831       3914   0.978794   
7        001                     1564        761        803   0.947696   
8        002                     1235        626        609   1.027915   
9        003                     1105        524        581   0.901893   

           Unnamed: 8 Unnamed: 9 Unnamed: 10      Unnamed: 11 Unnamed: 12  
0                 NaN        NaN         NaN              NaN         NaN  
1                 NaN        NaN         NaN              NaN         NaN  
2                 NaN        NaN         NaN              NaN         NaN  
3  Grupos de edad (%)        NaN         NaN  Extranjeros (%)         NaN  
4                0-19      20-64        &gt;=65            UE-27       Resto  
5                 NaN        NaN         NaN              NaN         NaN  
6           20.309877  58.218205   21.471917         1.781795    5.293738  
7           25.831202  59.143223   15.025575         1.534527    4.987212  
8           15.708502  52.307692   31.983806         1.133603    5.425101  
9           15.384615  59.728507   24.886878         2.624434    8.868778  </code></pre>
</div>
</div>
<div id="5959e2e1" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_clipped <span class="op">=</span> df_excel[<span class="dv">6</span>:]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df_clipped <span class="op">=</span> df_clipped.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_clipped.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Unnamed: 0 Unnamed: 1 Unnamed: 2 Unnamed: 3 Unnamed: 4 Unnamed: 5  \
0        001    Abadiño         01        000       7745       3831   
1        NaN        NaN        NaN        001       1564        761   
2        NaN        NaN        NaN        002       1235        626   
3        NaN        NaN        NaN        003       1105        524   
4        NaN        NaN        NaN        004       2076       1051   

  Unnamed: 6 Unnamed: 7 Unnamed: 8 Unnamed: 9 Unnamed: 10 Unnamed: 11  \
0       3914   0.978794  20.309877  58.218205   21.471917    1.781795   
1        803   0.947696  25.831202  59.143223   15.025575    1.534527   
2        609   1.027915  15.708502  52.307692   31.983806    1.133603   
3        581   0.901893  15.384615  59.728507   24.886878    2.624434   
4       1025   1.025366  24.662813  62.331407    13.00578    1.830443   

  Unnamed: 12  
0    5.293738  
1    4.987212  
2    5.425101  
3    8.868778  
4    3.709056  </code></pre>
</div>
</div>
<div id="94aede52" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_ff <span class="op">=</span> df_clipped.fillna(method<span class="op">=</span><span class="st">'ffill'</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_ff.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Unnamed: 0 Unnamed: 1 Unnamed: 2 Unnamed: 3  Unnamed: 4  Unnamed: 5  \
0        001    Abadiño         01        000        7745        3831   
1        001    Abadiño         01        001        1564         761   
2        001    Abadiño         01        002        1235         626   
3        001    Abadiño         01        003        1105         524   
4        001    Abadiño         01        004        2076        1051   

   Unnamed: 6  Unnamed: 7  Unnamed: 8  Unnamed: 9  Unnamed: 10  Unnamed: 11  \
0        3914    0.978794   20.309877   58.218205    21.471917     1.781795   
1         803    0.947696   25.831202   59.143223    15.025575     1.534527   
2         609    1.027915   15.708502   52.307692    31.983806     1.133603   
3         581    0.901893   15.384615   59.728507    24.886878     2.624434   
4        1025    1.025366   24.662813   62.331407    13.005780     1.830443   

   Unnamed: 12  
0     5.293738  
1     4.987212  
2     5.425101  
3     8.868778  
4     3.709056  </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_2613/2998331537.py:1: FutureWarning: DataFrame.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  df_ff = df_clipped.fillna(method='ffill')
/tmp/ipykernel_2613/2998331537.py:1: FutureWarning: Downcasting object dtype arrays on .fillna, .ffill, .bfill is deprecated and will change in a future version. Call result.infer_objects(copy=False) instead. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  df_ff = df_clipped.fillna(method='ffill')</code></pre>
</div>
</div>
<div id="67aa5548" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_ff.columns <span class="op">=</span> [<span class="st">'Cod'</span>, <span class="st">'Municipio'</span>,<span class="st">'Dist'</span>, <span class="st">'Secc'</span>, <span class="st">'Total'</span>, <span class="st">'Hombres'</span>, <span class="st">'Mujeres'</span>, <span class="st">'Sex ratio'</span>, <span class="st">'0-19'</span>, <span class="st">'20-64'</span>, <span class="st">'&gt;=65'</span>, <span class="st">'UE-27'</span>, <span class="st">'Resto'</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_ff.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Cod Municipio Dist Secc  Total  Hombres  Mujeres  Sex ratio       0-19  \
0  001   Abadiño   01  000   7745     3831     3914   0.978794  20.309877   
1  001   Abadiño   01  001   1564      761      803   0.947696  25.831202   
2  001   Abadiño   01  002   1235      626      609   1.027915  15.708502   
3  001   Abadiño   01  003   1105      524      581   0.901893  15.384615   
4  001   Abadiño   01  004   2076     1051     1025   1.025366  24.662813   

       20-64       &gt;=65     UE-27     Resto  
0  58.218205  21.471917  1.781795  5.293738  
1  59.143223  15.025575  1.534527  4.987212  
2  52.307692  31.983806  1.133603  5.425101  
3  59.728507  24.886878  2.624434  8.868778  
4  62.331407  13.005780  1.830443  3.709056  </code></pre>
</div>
</div>
</section>
<section id="opening-geospatial-files" class="level2">
<h2 class="anchored" data-anchor-id="opening-geospatial-files">Opening geospatial files</h2>
<div id="e7d037f3" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>gdf_geoms <span class="op">=</span> gpd.read_file(<span class="st">'./data/bilbao_census_geoms.gpkg'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gdf_geoms.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   id       cusec  cumun csec cdis cmun cpro cca    cudis  clau2         npro  \
0   1  0100101001  01001  001   01  001   01  16  0100101  01001  Araba/Álava   
1   2  0100101002  01001  002   01  001   01  16  0100101  01001  Araba/Álava   
2   3  0100201001  01002  001   01  002   01  16  0100201  01002  Araba/Álava   
3   4  0100201002  01002  002   01  002   01  16  0100201  01002  Araba/Álava   
4   5  0100201003  01002  003   01  002   01  16  0100201  01002  Araba/Álava   

          nca cnut0 cnut1 cnut2 cnut3              nmun  \
0  País Vasco    ES     2     1     1  Alegría-Dulantzi   
1  País Vasco    ES     2     1     1  Alegría-Dulantzi   
2  País Vasco    ES     2     1     1           Amurrio   
3  País Vasco    ES     2     1     1           Amurrio   
4  País Vasco    ES     2     1     1           Amurrio   

                                            geometry  
0  MULTIPOLYGON (((3300285.483 2277950.003, 33003...  
1  MULTIPOLYGON (((3300455.616 2280198.743, 33004...  
2  MULTIPOLYGON (((3267249.273 2300194.927, 32672...  
3  MULTIPOLYGON (((3270958.603 2308427.228, 32713...  
4  MULTIPOLYGON (((3264736.159 2307779.458, 32646...  </code></pre>
</div>
</div>
</section>
<section id="linkages" class="level2">
<h2 class="anchored" data-anchor-id="linkages">Linkages</h2>
<div id="b17f3263" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_ff[<span class="st">'link_code'</span>] <span class="op">=</span> df_ff[<span class="st">'Cod'</span>] <span class="op">+</span> df_ff[<span class="st">'Dist'</span>] <span class="op">+</span> df_ff[<span class="st">'Secc'</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_ff.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Cod Municipio Dist Secc  Total  Hombres  Mujeres  Sex ratio       0-19  \
0  001   Abadiño   01  000   7745     3831     3914   0.978794  20.309877   
1  001   Abadiño   01  001   1564      761      803   0.947696  25.831202   
2  001   Abadiño   01  002   1235      626      609   1.027915  15.708502   
3  001   Abadiño   01  003   1105      524      581   0.901893  15.384615   
4  001   Abadiño   01  004   2076     1051     1025   1.025366  24.662813   

       20-64       &gt;=65     UE-27     Resto link_code  
0  58.218205  21.471917  1.781795  5.293738  00101000  
1  59.143223  15.025575  1.534527  4.987212  00101001  
2  52.307692  31.983806  1.133603  5.425101  00101002  
3  59.728507  24.886878  2.624434  8.868778  00101003  
4  62.331407  13.005780  1.830443  3.709056  00101004  </code></pre>
</div>
</div>
<div id="aee5b666" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>gdf_geoms[<span class="st">'link_code'</span>] <span class="op">=</span> gdf_geoms[<span class="st">'cmun'</span>] <span class="op">+</span> gdf_geoms[<span class="st">'cdis'</span>] <span class="op">+</span> gdf_geoms[<span class="st">'csec'</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gdf_geoms.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   id       cusec  cumun csec cdis cmun cpro cca    cudis  clau2         npro  \
0   1  0100101001  01001  001   01  001   01  16  0100101  01001  Araba/Álava   
1   2  0100101002  01001  002   01  001   01  16  0100101  01001  Araba/Álava   
2   3  0100201001  01002  001   01  002   01  16  0100201  01002  Araba/Álava   
3   4  0100201002  01002  002   01  002   01  16  0100201  01002  Araba/Álava   
4   5  0100201003  01002  003   01  002   01  16  0100201  01002  Araba/Álava   

          nca cnut0 cnut1 cnut2 cnut3              nmun  \
0  País Vasco    ES     2     1     1  Alegría-Dulantzi   
1  País Vasco    ES     2     1     1  Alegría-Dulantzi   
2  País Vasco    ES     2     1     1           Amurrio   
3  País Vasco    ES     2     1     1           Amurrio   
4  País Vasco    ES     2     1     1           Amurrio   

                                            geometry link_code  
0  MULTIPOLYGON (((3300285.483 2277950.003, 33003...  00101001  
1  MULTIPOLYGON (((3300455.616 2280198.743, 33004...  00101002  
2  MULTIPOLYGON (((3267249.273 2300194.927, 32672...  00201001  
3  MULTIPOLYGON (((3270958.603 2308427.228, 32713...  00201002  
4  MULTIPOLYGON (((3264736.159 2307779.458, 32646...  00201003  </code></pre>
</div>
</div>
<div id="f520d782" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>merged_data <span class="op">=</span> gdf_geoms.merge(df_ff, on<span class="op">=</span><span class="st">'link_code'</span>, how<span class="op">=</span><span class="st">'outer'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(merged_data.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      id       cusec  cumun csec cdis cmun cpro  cca    cudis  clau2  ...  \
0    NaN         NaN    NaN  NaN  NaN  NaN  NaN  NaN      NaN    NaN  ...   
1    1.0  0100101001  01001  001   01  001   01   16  0100101  01001  ...   
2  241.0  2000101001  20001  001   01  001   20   16  2000101  20001  ...   
3  779.0  4800101001  48001  001   01  001   48   16  4800101  48001  ...   
4    2.0  0100101002  01001  002   01  001   01   16  0100101  01001  ...   

  Secc   Total Hombres Mujeres Sex ratio       0-19      20-64       &gt;=65  \
0  000  7745.0  3831.0  3914.0  0.978794  20.309877  58.218205  21.471917   
1  001  1564.0   761.0   803.0  0.947696  25.831202  59.143223  15.025575   
2  001  1564.0   761.0   803.0  0.947696  25.831202  59.143223  15.025575   
3  001  1564.0   761.0   803.0  0.947696  25.831202  59.143223  15.025575   
4  002  1235.0   626.0   609.0  1.027915  15.708502  52.307692  31.983806   

      UE-27     Resto  
0  1.781795  5.293738  
1  1.534527  4.987212  
2  1.534527  4.987212  
3  1.534527  4.987212  
4  1.133603  5.425101  

[5 rows x 32 columns]</code></pre>
</div>
</div>
<div id="a2902369" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>merged_data.to_file(<span class="st">'./data/joined_gpd.gpkg'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapter_2/open_source.html" class="pagination-link" aria-label="Open Source">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Open Source</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/Norman-Foster-Institute/ua_2024/blob/main/LICENSE">
<p>License</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>